<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Gielinor | Clan Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="clan_data.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --obsidian: #050505;
            --dark-metal: #0a0a0a;
            --card-bg: rgba(5, 5, 5, 0.65);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --glass-blur: blur(12px);
            
            --neon-gold: #FFD700;
            --neon-red: #FF3333;
            --neon-green: #33FF33;
            --neon-blue: #00d4ff;
            
            --text-main: #E0E0E0;
            --text-mute: #888888;
            
            --text-glow: 0 0 10px rgba(255, 255, 255, 0.1);
            --box-glow: 0 0 15px rgba(0, 0, 0, 0.5);
            
            --font-headings: 'Cinzel', serif;
            --font-body: 'Outfit', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--obsidian);
            color: var(--text-main);
            font-family: var(--font-body);
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(51, 255, 51, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 51, 51, 0.03) 0%, transparent 20%);
        }

        h1, h2, h3, h4, h5, h6, .sidebar-title, .stat-value, th, .bingo-boss-name, .chart-title {
            font-family: var(--font-headings);
            letter-spacing: 1px;
            text-shadow: var(--text-glow);
            text-transform: uppercase;
        }

        /* Glassmorphism Classes */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.6);
        }

        .neon-border-gold { border-color: var(--neon-gold) !important; box-shadow: 0 0 10px rgba(255, 215, 0, 0.15); }
        .neon-border-red { border-color: var(--neon-red) !important; box-shadow: 0 0 10px rgba(255, 51, 51, 0.15); }
        .neon-border-green { border-color: var(--neon-green) !important; box-shadow: 0 0 10px rgba(51, 255, 51, 0.15); }
        
        /* ALERT CARDS */
        .alert-card {
            padding: 20px;
            position: relative;
            background: rgba(255, 51, 51, 0.03);
            border: 1px solid var(--neon-red);
            box-shadow: 0 0 12px rgba(255, 51, 51, 0.15) inset, 0 4px 20px rgba(0,0,0,0.5);
            border-radius: 8px;
            transition: 0.3s;
        }
        
        .alert-card:hover {
           background: rgba(255, 51, 51, 0.06);
           box-shadow: 0 0 15px rgba(255, 51, 51, 0.25) inset, 0 8px 25px rgba(0,0,0,0.6); 
           transform: translateY(-2px);
        }

        /* Container & Layout Optimization for Desktop */
        .container {
            display: flex;
            max-width: 100vw;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* SHIMMER SKELETON */
        .skeleton-text {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.05) 25%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer-text 1.5s infinite;
            border-radius: 4px;
            color: transparent !important;
            display: inline-block;
            width: 100%;
            height: 1em;
        }

        @keyframes shimmer-text {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* LAYOUT CONTROLS */
        .container {
            display: flex;
            min-height: 100vh;
            max-width: 100vw;
        }

        .sidebar {
            width: 280px;
            background: var(--dark-metal);
            border-right: var(--glass-border);
            padding: 40px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            backdrop-filter: var(--glass-blur);
            z-index: 100;
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 40px;
            max-width: 1400px;
            margin-right: auto;
        }

        .sidebar-title {
            font-size: 24px;
            margin-bottom: 40px;
            text-align: center;
            color: var(--neon-gold);
            text-shadow: var(--text-glow);
        }

        /* ALERTS SECTION */
        .section-container {
            margin-top: 40px;
            margin-bottom: 40px;
        }

        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--neon-gold);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: var(--text-glow);
        }

        .alert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .alert-card {
            padding: 25px;
            position: relative;
            background: rgba(255, 51, 51, 0.05);
            border-left: 4px solid var(--neon-red);
        }

        .alert-name { font-family: 'Cinzel', serif; font-size: 1.2rem; color: #fff; margin-bottom: 5px; }
        .alert-reason { color: var(--text-mute); font-size: 0.9rem; }

        /* BINGO GRID */
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .bingo-card {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bingo-card.completed {
            background: rgba(51, 255, 51, 0.1);
            border: 2px solid var(--neon-green);
            box-shadow: inset 0 0 20px rgba(51, 255, 51, 0.1);
        }

        .bingo-boss-name { font-family: 'Cinzel', serif; font-size: 0.9rem; color: var(--text-mute); margin-top: 15px; }
        .bingo-progress { font-size: 1.4rem; font-weight: 700; color: #fff; }

        .nav-item {
            padding: 12px 20px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
            color: var(--text-mute);
            font-weight: 600;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            color: var(--neon-blue);
            background: rgba(51, 204, 255, 0.05);
            border-color: rgba(51, 204, 255, 0.2);
            box-shadow: 0 0 10px rgba(51, 204, 255, 0.1);
        }

        .nav-item.active {
            color: var(--obsidian);
            background: var(--neon-gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #222;
        }

        .header h1 {
            font-size: 36px;
            color: var(--text-main);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .search-box {
            background: #111;
            border: 1px solid #333;
            color: var(--neon-blue);
            padding: 10px 15px;
            border-radius: 4px;
            font-family: 'Outfit', sans-serif;
            width: 250px;
            transition: 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(51, 204, 255, 0.2);
        }

        /* CARDS & GLASSMORPHISM */
        .stat-card,
        .chart-container,
        .chart-item,
        .table-container,
        .inactive-alert {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: var(--glass-border);
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:after,
        .chart-container:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--glass-shine);
            pointer-events: none;
            z-index: 1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-mute);
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 32px;
            color: #fff;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .stat-description {
            font-size: 13px;
            color: var(--neon-blue);
        }

        .stat-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.1);
        }

        /* CHARTS */
        .dual-chart {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .chart-item-title,
        .chart-title {
            font-family: 'Cinzel', serif;
            color: var(--text-main);
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* TABLES */
        .table-container {
            padding: 0;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(0, 0, 0, 0.4);
            padding: 16px;
            text-align: left;
            font-family: 'Cinzel', serif;
            color: var(--neon-gold);
            font-weight: 500;
            border-bottom: 1px solid #333;
        }

        td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #ccc;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.03);
            color: #fff;
        }

        /* ALERT BOXES */
        .inactive-alert {
            border: 1px solid rgba(255, 51, 51, 0.3);
            background: rgba(20, 5, 5, 0.8);
        }

        .alert-title {
            color: var(--neon-red);
            font-family: 'Cinzel', serif;
            margin-bottom: 15px;
        }

        .inactive-tag {
            display: inline-block;
            padding: 6px 12px;
            font-size: 11px;
            background: rgba(255, 51, 51, 0.1);
            color: var(--neon-red);
            border: 1px solid rgba(255, 51, 51, 0.3);
            border-radius: 4px;
            margin: 4px;
        }

        /* UTILS */
        .loading {
            color: var(--neon-blue);
            text-align: center;
            padding: 20px;
        }

        .section {
            display: none;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .section.active {
            display: block;
            opacity: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 15px;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .container {
                flex-direction: column;
            }

            .dual-chart {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            #general-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Hall of Fame Visuals */
        .hof-gold {
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.6);
            background: rgba(255, 215, 0, 0.05) !important;
        }

        .hof-red {
            border-left: 3px solid #ff4444 !important;
            background: linear-gradient(90deg, rgba(255, 0, 0, 0.1) 0%, transparent 100%);
        }

        .hof-blue {
            border-right: 3px solid #00d4ff !important;
        }

        /* Comparator Table */
        #comparator-table th,
        #comparator-table td {
            text-align: center;
        }

        #comparator-table td:first-child,
        #comparator-table th:first-child {
            text-align: left;
            font-weight: bold;
            color: #ccc;
        }

        .diff-pos {
            color: #00d4ff;
            font-weight: bold;
        }

        .diff-neg {
            color: #ffb84d;
            font-weight: bold;
        }

        .diff-neu {
            color: #888;
        }
    </style>
</head>

<body>
    <div class="container">
        < !-- Sidebar Navigation -->
            <div class="sidebar">
                <div class="sidebar-title">CLAN<br>STATS</div>
                <div class="nav-item active" onclick="switchSection('general')">General</div>
                <div class="nav-item" onclick="switchSection('outliers')">Outliers</div>
                <div class="nav-item" onclick="switchSection('messages')">Messages</div>
                <div class="nav-item" onclick="switchSection('bosses')">Bosses</div>
                <div class="nav-item" onclick="switchSection('xp-gains')">XP Gains</div>
                <div class="nav-item" onclick="switchSection('roster')"><i class="fas fa-users"></i>Full Roster</div>
            </div>
            < !-- Main Content -->
                <div class="main-content">
                    < !-- General Section -->
                        <div id="general" class="section active">
                            <div class="header">
                                <h1>General</h1>
                                <div style="text-align: right;">
                                    <div class="header-info">Updated: <span id="updated-time">loading...</span></div>
                                    <input type="text" class="search-box" id="search-general"
                                        placeholder="Search player...">
                                </div>
                            </div>
                            < !-- Weekly Briefing (Command Center) -->
                                <div class="stat-card"
                                    style="width: 100%; margin-bottom: 30px; background: linear-gradient(90deg, rgba(0, 212, 255, 0.15) 0%, rgba(0, 100, 150, 0.15) 100%);">
                                    <div class="stat-label" style="display: flex; align-items: center; gap: 10px;"><i
                                            class="fas fa-terminal"></i>WEEKLY INTELLIGENCE BRIEFING </div>
                                    <div class="stat-value"
                                        style="font-size: 16px; font-weight: normal; line-height: 1.6; color: #b3ecff;"
                                        id="weekly-briefing-text"><span class="loading">
                                            <div class="spinner"
                                                style="width: 15px; height: 15px; border-width: 2px; display: inline-block;vertical-align: middle; margin: 0 10px;">
                                            </div>Analysing clan telemetry...
                                        </span></div>
                                </div>
                                <div class="stats-grid" id="general-stats">
                                    <div class="stat-card">
                                        <div class="stat-label">Top Messenger</div>
                                        <div class="stat-value" id="top-messenger-val">0</div>
                                        <div class="stat-description" id="top-messenger-name">Loading...</div><i
                                            class="fas fa-comment-dots stat-icon"></i>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-label">Top XP Gained (7d)</div>
                                        <div class="stat-value" id="top-xp-val">0</div>
                                        <div class="stat-description" id="top-xp-name">Loading...</div><i
                                            class="fas fa-chart-line stat-icon"></i>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-label">Rising Star (Newbie)</div>
                                        <div class="stat-value" id="rising-star-val">0</div>
                                        <div class="stat-description" id="rising-star-name">Loading...</div><i
                                            class="fas fa-star stat-icon"></i>
                                    </div>
                                        <div class="stat-card">
                                            <div class="stat-label">Top Boss Killer</div>
                                            <div class="stat-value" id="top-boss-val">0</div>
                                            <div class="stat-description" id="top-boss-name">Loading...</div><i
                                                class="fas fa-skull stat-icon"></i>
                                        </div>
                                    </div>

                                    <!-- MODERATION ALERTS (ALERT CARDS) -->
                                    <div class="section-container">
                                        <div class="section-title"><i class="fas fa-exclamation-triangle"></i> Strategic Alerts</div>
                                        <div id="alert-cards-container" class="alert-grid">
                                            <!-- Dynamic Alert Cards will be injected here -->
                                            <div class="glass-card neon-border-red" style="padding: 20px; text-align: center;">
                                                <div class="stat-label">Scanning for Risks...</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CLAN BINGO GRID -->
                                    <div class="section-container">
                                        <div class="section-title"><i class="fas fa-grid-2"></i> Clan Bingo Progress</div>
                                        <div id="bingo-grid" class="bingo-grid">
                                            <!-- Dynamic Bingo Items will be injected here -->
                                            <div class="glass-card" style="padding: 40px; text-align: center; color: var(--text-mute);">
                                                Initializing Bingo Engine...
                                            </div>
                                        </div>
                                    </div>

                                    <div class="dual-chart">
                                    <div class="chart-item">
                                        <div class="chart-item-title">Clan Activity Health</div>
                                        <div class="chart-wrapper"><canvas id="activity-health-chart"></canvas>
                                        </div>
                                    </div>
                                    <div class="chart-item">
                                        <div class="chart-item-title">Top XP Contributors (7d)</div>
                                        <div class="chart-wrapper"><canvas id="top-xp-contributors-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="dual-chart">
                                    <div class="chart-item">
                                        <div class="chart-item-title"><i class="fas fa-chart-radar"></i>Top 5
                                            Player Comparison </div>
                                        <div class="chart-wrapper"><canvas id="player-radar-chart"></canvas>
                                        </div>
                                    </div>
                                    <div class="chart-item">
                                        <div class="chart-item-title"><i class="fas fa-chart-line"></i>Weekly
                                            Activity Trend</div>
                                        <div class="chart-wrapper"><canvas id="activity-trend-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <div class="chart-title"><i class="fas fa-trophy"></i>Top 10 Leaderboard
                                        (Composite Score) </div>
                                    <div class="chart-wrapper"><canvas id="leaderboard-chart"></canvas></div>
                                </div>
                                <div class="chart-container">
                                    <div class="chart-title">Recent Activity (7 Days)</div>
                                    <div class="table-container" style="padding: 0;">
                                        <table id="recent-activity-table">
                                            <thead>
                                                <tr>
                                                    <th>Rank</th>
                                                    <th>Player</th>
                                                    <th>Messages</th>
                                                    <th>XP Gained</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td colspan="4" class="loading">
                                                        <div class="spinner"></div>Loading...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="inactive-alert">
                                    <div class="alert-title">⚠️ Inactive Watchlist (0 Msgs in 30d)</div>
                                    <div class="inactive-tags" id="inactive-watchlist">
                                        <div class="loading">
                                            <div class="spinner"></div>Loading...
                                        </div>
                                    </div>
                                </div>
                        </div>
                        < !-- Comparator Section -->
                            <div id="comparator" class="section">
                                <div class="header">
                                    <h1>Head-to-Head Comparator</h1>
                                </div>
                                <div class="comparator-controls"
                                    style="display: flex; gap: 20px; margin-bottom: 30px; background: rgba(0, 212, 255, 0.05); padding: 20px; border-radius: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">
                                    <div style="flex: 1;"><label
                                            style="color: #00d4ff; display: block; margin-bottom: 5px;">Player A
                                            (Blue)</label><input type="text" id="comp-p1" list="player-list"
                                            class="search-box" style="width: 100%;" placeholder="Select Player A...">
                                    </div>
                                    <div
                                        style="flex: 0 0 50px; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 24px; color: #fff; font-weight: bold;">VS</span>
                                    </div>
                                    <div style="flex: 1;"><label
                                            style="color: #ffb84d; display: block; margin-bottom: 5px;">Player B
                                            (Orange)</label><input type="text" id="comp-p2" list="player-list"
                                            class="search-box" style="width: 100%;" placeholder="Select Player B...">
                                    </div><datalist id="player-list"></datalist>
                                </div>
                                <div class="dual-chart">
                                    <div class="chart-item">
                                        <div class="chart-item-title">Skill & Activity Comparison</div>
                                        <div class="chart-wrapper"><canvas id="comparator-radar"></canvas></div>
                                    </div>
                                    <div class="chart-item">
                                        <div class="chart-item-title">Tale of the Tape</div>
                                        <div class="table-container"
                                            style="padding: 0; background: transparent; border: none; box-shadow: none;">
                                            <table id="comparator-table">
                                                <thead>
                                                    <tr>
                                                        <th>Metric</th>
                                                        <th style="color: #00d4ff;">Player A</th>
                                                        <th style="color: #ffb84d;">Player B</th>
                                                        <th>Diff</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="comparator-body">
                                                    <tr>
                                                        <td colspan="4" style="text-align: center; color: #888;">Select
                                                            two
                                                            players to compare</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            < !-- Messages Section -->
                                <div id="messages" class="section">
                                    <div class="header">
                                        <h1>Messages</h1>
                                        <div style="text-align: right;">
                                            <div class="header-info">Updated: <span
                                                    id="updated-time-msg">loading...</span></div><input type="text"
                                                class="search-box" id="search-messages" placeholder="Search player...">
                                        </div>
                                    </div>
                                    <div class="dual-chart">
                                        <div class="chart-item">
                                            <div class="chart-item-title">Message Volume (Top 5)</div>
                                            <div class="chart-wrapper"><canvas id="message-volume-chart"></canvas></div>
                                        </div>
                                        <div class="chart-item">
                                            <div class="chart-item-title"><i class="fas fa-chart-pie"></i>Role
                                                Distribution</div>
                                            <div class="chart-wrapper"><canvas id="role-distribution-chart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container">
                                        <div class="chart-title"><i class="fas fa-th"></i>Activity Heatmap
                                            (Hourly)</div>
                                        <div class="chart-wrapper"><canvas id="activity-heatmap-chart"></canvas>
                                        </div>
                                    </div>
                                    <div class="table-container">
                                        <table id="messages-table">
                                            <thead>
                                                <tr>
                                                    <th>Player</th>
                                                    <th>Role</th>
                                                    <th>Total Messages</th>
                                                    <th>Last 7 Days</th>
                                                    <th>Last 30 Days</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td colspan="5" class="loading">
                                                        <div class="spinner"></div>Loading...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                < !-- XP Gains Section -->
                                    <div id="xp-gains" class="section">
                                        <div class="header">
                                            <h1>XP Gains</h1>
                                            <div style="text-align: right;">
                                                <div class="header-info">Updated: <span
                                                        id="updated-time-xp">loading...</span></div><input type="text"
                                                    class="search-box" id="search-xp" placeholder="Search player...">
                                            </div>
                                        </div>
                                        <div class="dual-chart">
                                            <div class="chart-item">
                                                <div class="chart-item-title">XP Gains (7d) vs Total XP</div>
                                                <div class="chart-wrapper"><canvas id="xp-7d-chart"></canvas>
                                                </div>
                                            </div>
                                            <div class="chart-item">
                                                <div class="chart-item-title">XP vs Boss Kills</div>
                                                <div class="chart-wrapper"><canvas id="xp-boss-chart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="chart-container">
                                            <div class="chart-title"><i class="fas fa-chart-scatter"></i>XP vs
                                                Messages Correlation</div>
                                            <div class="chart-wrapper"><canvas id="xp-messages-scatter"></canvas></div>
                                        </div>
                                        <div class="table-container">
                                            <table id="xp-table">
                                                <thead>
                                                    <tr>
                                                        <th>Player</th>
                                                        <th>Role</th>
                                                        <th>Total XP</th>
                                                        <th>XP Gained (7d)</th>
                                                        <th>XP Gained (30d)</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="5" class="loading">
                                                            <div class="spinner"></div>Loading...
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    < !-- Outliers Section -->
                                        <div id="outliers" class="section">
                                            <div class="header">
                                                <h1>Outliers</h1>
                                                <div style="text-align: right;">
                                                    <div class="header-info">Updated: <span
                                                            id="updated-time-out">loading...</span></div><input
                                                        type="text" class="search-box" id="search-outliers"
                                                        placeholder="Search player...">
                                                </div>
                                            </div>
                                            <div class="chart-container">
                                                <div class="chart-title">Members with Unusual Activity Patterns
                                                </div>
                                                <div class="table-container" style="padding: 0;">
                                                    <table id="outliers-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Player</th>
                                                                <th>Role</th>
                                                                <th>7d Messages</th>
                                                                <th>7d XP Gain</th>
                                                                <th>Avg Daily Msgs</th>
                                                                <th>Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td colspan="6" class="loading">
                                                                    <div class="spinner"></div>Loading...
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        < !-- Roster Section -->
                                            <div id="roster" class="section">
                                                <div class="header">
                                                    <h1>Full Roster</h1>
                                                    <div style="text-align: right;"><input type="text"
                                                            class="search-box" id="search-roster"
                                                            placeholder="Search player..."></div>
                                                </div>
                                                <div class="table-container">
                                                    <table id="roster-table" class="sortable">
                                                        <thead>
                                                            <tr>
                                                                <th onclick="sortTable(0)">Player <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(1)">XP (7d) <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(2)">XP (Total) <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(3)">Boss (7d) <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(4)">Boss (Total) <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(5)">Msgs (7d) <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(6)">Msgs (Total) <i
                                                                        class="fas fa-sort"></i></th>
                                                                <th onclick="sortTable(7)">Ratio <i
                                                                        class="fas fa-sort"></i></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="roster-body">
                                                            < !-- Populated by JS -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            < !-- Bosses Section -->
                                                <div id="bosses" class="section">
                                                    <div class="header">
                                                        <h1>Boss Activity</h1>
                                                        <div style="text-align: right;">
                                                            <div class="header-info">Updated: <span
                                                                    id="updated-time-boss">loading...</span>
                                                            </div><input type="text" class="search-box"
                                                                id="search-bosses" placeholder="Search player...">
                                                        </div>
                                                    </div>
                                                    < !-- New Boss Cards -->
                                                        <div class="stats-grid" id="boss-cards">
                                                            <div class="loading">Loading boss highlights...
                                                            </div>
                                                        </div>
                                                        <div class="chart-container">
                                                            <div class="chart-title">Boss Killers Leaderboard
                                                            </div>
                                                            <div class="table-container" style="padding: 0;">
                                                                <table id="bosses-table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Rank</th>
                                                                            <th>Player</th>
                                                                            <th>Role</th>
                                                                            <th>Total Kills</th>
                                                                            <th>Kills (7d)</th>
                                                                            <th>Kills (30d)</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td colspan="6" class="loading">
                                                                                <div class="spinner"></div>
                                                                                Loading...
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                </div>
                                                <script>const API_URL = 'http://localhost:5000/api';

                                                                 Data = {}

                                                                                                                            {}

                                                                                                                            tions
                                                                 tions
                                                                 n switchSection(sectionId) {
                                                                     ySelectorAll('.section').forEach(s => s.classList.remove('active'));
                                                                     ySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

                                                                     = document.getElementById(sectionId);
                                                                     arget.classList.add('active');

                                                                     nav - improved logic
                                                                     document.querySelectorAll('.nav-item');

                                                                     n => {
                                                                         n.textContent.trim().toLowerCase();
                                                                         'full roster' && sectionId === 'roster') n.classList.add('active');
                                                                          === 'general' && sectionId === 'general') n.classList.add('active');
                                                                         .includes('comparator') && sectionId === 'comparator') n.classList.add('active');
                                                                         .includes(sectionId.replace('-', ' '))) n.classList.add('active');
                                                                                                                                   === 'comparator') {
                                                                         a is loaded first
                                                                         boardData();
                                                                         or();
                                                                                                                                ionId === 'general') loadGeneralData();
                                                                     ionId === 'messages') loadMessagesData();
                                                                     ionId === 'xp-gains') loadXPGainsDataBubble();
                                                                     ionId === 'outliers') loadOutliersData();
                                                                     ionId === 'bosses') loadBossesData();
                                                                     ionId === 'roster') loadRosterData();

                                                                     t resize
                                                                      => window.dispatchEvent(new Event('resize')), 50);
                                                                                                                        n getDashboardData() {
                                                                     shboardData) return window.dashboardData;

                                                                                                                                       e = await fetch('clan_data.json');
                                                                         response.json();
                                                                                                                                                                                                        lementById('general-stats').innerHTML = '<div class="loading">Failed to load data</div>';
                                                                         (e);
                                                                                                                                                                                  RTING/BUBBLE LOGIC ---
                                                                 Sorting
                                                                 Table(n) {
                                                                      document.getElementById("roster-table");
                                                                      table.querySelector('tbody');
                                                                     Array.from(tbody.rows);

                                                                     ection
                                                                     r = table.getAttribute('data-sort-dir') === 'asc' ? 'desc' : 'asc';
                                                                      asc for first click
                                                                     tAttribute('data-sort-dir')) currentDir = 'asc';
                                                                     ibute('data-sort-dir', currentDir);

                                                                     clean data
                                                                     = (row, index) => {
                                                                         row.cells[index];
                                                                         cell.innerText || cell.textContent;
                                                                         M, +, commas for numbers
                                                                          text.replace(/[+, kM]/g, '').replace(/, /g, '');
                                                                         arseFloat(clean);
                                                                         ber if valid, else lowercase string
                                                                         num) ? text.toLowerCase() : num;
                                                                                                                                                                                                b) => {
                                                                         getVal(a, n);
                                                                         getVal(b, n);

                                                                         lB) return currentDir === 'asc' ? -1 : 1;
                                                                         lB) return currentDir === 'asc' ? 1 : -1;
                                                                                                                                                                                                        rows (instant)
                                                                     row => tbody.appendChild(row));
                                                                                                                        erRoster() {
                                                                      document.getElementById("search-roster");
                                                                     = input.value.toUpperCase();
                                                                      document.getElementById("roster-table");
                                                                     ble.getElementsByTagName("tr");

                                                                     0; i < tr.length; i++) {
                                                                         [i].getElementsByTagName("td")[0];

                                                                                                                                                   e = td.textContent || td.innerText;
                                                                             toUpperCase().indexOf(filter) > -1) tr[i].style.display = "";
                                                                             yle.display = "none";
                                                                                                                                                                                                                                                 Logic
                                                                 pComparator() {
                                                                     document.getElementById('player-list');
                                                                     turn;

                                                                     dren.length === 0 && window.dashboardData && window.dashboardData.allMembers) {
                                                                         ardData.allMembers.forEach(m => {
                                                                             ocument.createElement('option');
                                                                             .username;
                                                                             ild(opt);
                                                                                                                                                                                                ocument.getElementById('comp-p1');
                                                                     ocument.getElementById('comp-p2');
                                                                     = updateComparator;
                                                                     = updateComparator;
                                                                      updateComparator;
                                                                      updateComparator;
                                                                                                                        rChart = null;

                                                                 teComparator() {
                                                                     = document.getElementById('comp-p1').value.toLowerCase();
                                                                     = document.getElementById('comp-p2').value.toLowerCase();

                                                                     ashboardData || !window.dashboardData.allMembers) return;

                                                                     ndow.dashboardData.allMembers.find(m => m.username.toLowerCase() === p1Name);
                                                                     ndow.dashboardData.allMembers.find(m => m.username.toLowerCase() === p2Name);

                                                                     2) return;

                                                                     le
                                                                      document.getElementById('comparator-body');

                                                                      = [{
                                                                          XP', key: 'total_xp', fmt: formatNumber
                                                                                                                                                                                                                                                            Kills', key: 'total_boss', fmt: formatNumber
                                                                                                                                                                                                                                                            ges', key: 'msgs_total', fmt: formatNumber
                                                                                                                                                                                                                                                            in Clan', key: 'days_in_clan', fmt: n => n + 'd'
                                                                                                                                                                                                                                                            ity (30d msg)', key: 'msgs_30d', fmt: formatNumber
                                                                                                                                                                                            ML = metrics.map(m => {
                                                                         [m.key] || 0;
                                                                         [m.key] || 0;
                                                                         v1 - v2;
                                                                         ss = diff > 0 ? 'diff-pos' : (diff < 0 ? 'diff-neg' : 'diff-neu');

                                                                          = diff > 0 ? `+${m.fmt(diff)
                                                                                                   }

                ` : (diff < 0 ?                                                                               {m.label                                                                                                                        /td> <td s                                                                d4ff;" >${m.fmt(v1)
                                                                                                                      </td> <td style="color: #ffb84d;" >${m.fmt(v2                                                                                                     }

                                                                                                                                     </td> </tr>`;
                                                          .join('');

                                                                                                                                                                                rator-radar')                                                          if (!ctx) return;

                                                                                                                                     const maxXP = Math.max(...window.dashboardData.allMembers.map(m => m                                                                     const maxBoss = Math.max(...window.dashboardData.allMembers.map(m => m.t                                                                     const maxMsg                                                        otal));

                                                                                                                                                                       {
                                                                                                                                                                   l)                                                                                 }

                                                                                                                                                               
                                                                                       ,
                                                                                                                                                                                         00),
                                                                                 als
                                                                                                                                                                                      
                                                                                       ,
                                                                                                                                                                                          0),
                                                                                                                                                                                                                                                                                rt(ctx, {                                                                pe: 'radar',
                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      er                                                                                                                                                ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        bo                                                                                                                                                                                                                                                                             ,                                                                    : {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               cc                                                                                                                                                                                                                                                                                     ,
                                                                                                                                                                                                                                                                                                                                 cc                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                       er-body');
                                                                                                                                                                    {
                                                                                                                                                       if (u.total_xp >= 20000                                                                                               else if (u.total_boss >= 50                                                                                            else if (u.msgs_total >= hof-blue';
                                                                                                            ss="${specialClass}" >                                                                 name
                                                                                                                  </strong></td> <td>${u.xp_7                                                                                                            }

             p_7d)
                                                                                                                  </td> <td>${format                                                                                                              }

                                                                             .boss_7d > 0 ? '+' : ''
                                                                                           }

                    ${form                                                                                                               }d> <td>${format                                                                
                                                                                                >${u.msgs_7d
                                                                                                                                                                                               </td> <td>${u.social_ratio
                                                                }

                    </td> </t                                                                 tbody.innerHTML += row;
                                                                                                                        }

                                                                                                                                                                                                                                                            document.                                                                                                                                                                                   // Fix for XP vs Boss &                                                                                             const ctx7d                                                                                                                                                                                                                 );
                                                                              .topXPGainers.slice(0, 10);
                                                                    charts['xp-7d'] = new Chart(ctx7d, {                                                                 ty                                                                                                                                                                                                                                                           : [{
                                                                        label: '7d XP Gained',
                                                                                      p(p => p.g                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : { responsive: t                                                                                                                                                          }

                                                                            ocument.getElementById('xp-messa                                                                        f                                                                                                                                            .m                                                                       x:                                                                                                                                                                                                     charts['xp-scatter'] = new Ch                                                                                                                                                           dat                                                                            s: [{
                                                                                   Act                                                                        rColor: '#                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                      tRatio: fal                                                                    scales: {
                                                                                                                                                                  c', title: {
                                                                                           text: 'Messages', color: '#88                                                                                                  }

                                                                                                                                                                '#e0e0e0'
                                                                                                                                                                                                                 g                                                                                                                                                                                                                                                                                                                                                                                                      y: {
                                                                                                                                                                                         : true, text: 'XP Gained', color:                                                                                }

                                                                                                           , ticks: {
                                                               color: '#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }
                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     .x
                                                                                    }

                                                                                                                                                                                                                                                          }
                                                                        }
                                                                                                                                                                                                            }
                                                                                                                            co                                                                                                                                                                                              data.topXPGainers.forEach(p => {
                                                                             = `<tr><td>${p.name
                                                                                                                    role-member" >Member</span></td><td>${formatNumber(p.total)
                                                                        }

                </td><td style="color: #00d4ff" >+${formatNumber(p.gained7d)
                                                                                                       }

                </td                                                                                                             </td></tr>`;
                                                           
                                                                                                                   // Format numbers
                                                                     
                                                                                                                                                                                         ';
                                                        if (isNaN(num)) r                                                                   num = Number(num);
                                                         f (num                                                                                                                                                                                                                                                ring();
                                                            }

                                                                                                                                                                                                                                const r = role.toLowerCase().trim()                                                            t iconRole = r.rep                                                                          // Fallbacks and                                                                           if (r.includes('saviour')) iconRole =                                                                                                                                                                                                               e = 'owner';
                                                                                                      /                                                                                                                            = 'recrui                                                                                                                                                0,0.2); color: #ccc; disp                                                                ${iconRole}.png" style="height: 16px; width: 16px;" onerror="this.style.display='none'">${role
                                                                           </span>`;
                                                            }

                                                                   He                                                            nc function getDa                                                                        if (window.d                                                                                                   const response = await fetch('clan_data.json');
                                                                     response.json();
                                                                                                                      Loa                                                                   async function load                                                                        try {
                                                                         await getDashboardData();

                                                                                                                                                    document.getElementById('updated-time').textContent = data.las                                                                                                                           riefing
                                                                          El = document.getElemen                                                                                            if (briefingEl) {
                                                                                                                                                                       briefiklyBriefing;
                                                                                                                                                                                                                  else {
                                                                    b                                                                                                                 }
                                                                                                                                                                                                         // Update Top                                                                       if (data.topMessenger) {
                                                                                                                  ontent = formatNumber(data.topMessenger.messages);
                                                                                               document.getElementById('                                                                                                                                                                                                                                                                                                                                                           document.getElementById('top-xp-val').textContent = form                                                                                                                             .textContent = da                                                                                 }

                                                                      Top Boss Killer
                                                                               ler) {
                                                                                   ById('top-boss-val').textContent                                                                                                                                                      t = data.topBossKiller.name;
                                                                                                                                                                                                                  ata.risingStar)                                                                   document.getElementById('rising-star-val').textC                                                                                                              document.getElementById('rising-star-name').textContent = `${data.risingStar.name
                                                                                                                              (${d                                                                                                                                                                                                                                                                              else if (data.risingStars && da                                                                                             //                                                                                                               const r                                                                                         document.getElementById('rising-star                                                                                                                                                                  {rs.name
                                                                     

                                                                                           }

                                                                                                                                                                               extContent = 'N/A';
                                                                                                              xtContent = 'No eligible members';
                                                                                                                                                                                                                                                                                                                        bu                                                                                                                                                                                         ata);
                                                                      erboardChart(data)                                                                dateRecentActivityTable(data                                                                pdateInacti                                                                           }

                                                                                                                                                              ng general data:', error);                                                                                tById('ge                                                                            ex                                                                                                                                              rr                                                                                                                                                                                                                                                                                                                                                                                               {
                                                                                                    y-health-chart');
                                                                                                        health'].destroy();

                                                                                      w Chart(ctx, {

                                                                                                                                                                                                                                                                                                                                                                                                                                                                 activeMembers                                                                             backgroundColor: ['#00d4ff',                                                                                 borderColor: '#1a2332',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ;
                                                                                                                      op X                                                                                                           ) {
                                                                                        yId('top-xp-contributors-chart');
                                                              arts['top-xp']) charts['top-xp'].destroy();

                                                                      ibutors = data.topXPContributors || [];

                                                                               Chart(ctx, {

                                                                                                                                                                                                                                                                                                                                                                                                                      data: topContributors.map(c => c.xp),                                                                                                                            #88                                                                            borderC                                                                                                                                                                                                                                                                                                                                                                    ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               font: {
                                                                                size: 10
                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                               // Create Radar Chart                                                                                                                                                                                                                                                                                                         r']) cha                                                                                        const radarData = data.radarComparison || [];

                                                                    ta.length) {
                                                                  tCo                                                                                                                          l';
                                                                        xt('2d').fillText(                                                                                                                                                                 }

                                                                       ['#00                                                                        84d',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        player.e                                                                        yer                                                                                                                                                                                                                                                                                                                                                poin                                                                                           pointBorderCol                                                                            tH                                                                                                                                                                                                                                                                                   

                                                                : 'radar',
                                                                                                                                                      d', 'Boss K                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ticks: {
                                                                            stepSize:                                                                                 color: '#888',
                                                                                         : 'transparent'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                 }
                                                                        }
                                                                                                                                                                                                                 ,                                                                 plugins: {
                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  tooltip: {
                                                                                                                                                                                    ntext) {
                                                                                retu                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                });
                                                                                                                   // Creat                                                                           functio                                                                                                                                                                                                                                  '])                                                                                                                              ;

                                                            !t                                                                                                                                                                                                                                                                                                                       data available                                                                         return;
                                                                                                                                                       (ct                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   25                                                                              te                                                                                fill: true,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 t.active_users),
                                                                         rColor: '                                                                              backgroundColor: 'rgba(2                                                                                        t                                                                                                                                                                                                                                                                                                                  ]                                                                                                                                                                                                                                                                                                                                                                                                                                                            interaction: {
                                                                             de                                                                                                                                                                                                                                                                                                ales: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  )'
                                                                                                                                                                                                                                                                                                                                                                                 type: 'line                                                                                                                                                                                                                                                                                                                                                              si                                                                                                                                                             }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ay                                                                                                                                                                                                                                                                ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                        ,
                                                                              {
                                                                                                                                                                                   }

                                                                                                       ,
                                                                                                       title: {
                                                                                                           display: true, text: 'Active Users', color: '#ffb84d'
                                                                                                       }
                                                                                                                                              }

                                                                                                                                  plugins: {
                                                                         d: {
                                                                                                                                                                             ', font: {
                                                                                        size: 11
                                                                                                                   }

                                                                   , padding: 15                                                                                                                                 }
                                                                            }

                                                                            ,
                                                                            tooltip: {
                                                               callbacks: {
                                                                                                                             ction (items) {
                                                                                                                                        return 'Week: ' + items[0].label;
                                                                                    }
                                                                                }
                                                                            }
                                                       }
                                                                                                                    }
                                                                                                                                                               }

                                                                                                                                                                   tyTable(data) {
                                                                      document.querySelector('#recent-activity-table tbody');

                                                                                                .map((item, idx) => ` <tr> <td>${idx + 1
                                                                                           }

                </td> <td>${i                                                                                                           (--neon-blue);" >${item.mess                                                                 }

                </td> <t                                                                                                                                                                                                                               tbody.in                                                        r>';
                                                                                                                   // --- N                                                                             function renderBossCards                                                                      if (!cardsData) return '';

                                                                 <div class="stat-card"><div class="stat-label">Weekly Top Boss</div><div                                                            ame
                                                            }

                                                        ardsData.weeklyTop.count)
                                                                           Kills (Clan Total)</div><img src="${getBossIco                                                            ; width: 64px; height: 64px; border-radius: 10%; object-fit: contain;" oner                                                            "><div class="sta                                                                : 24px;">${cardsData.allTimeFavorite.name
                                                                           </div><div class="stat-descri                                                                                                                           ills (Total)</div><img                                                                on" style="top: 10px; width: 64px; height: 64px                                                                ss_zulrah.png'"></div><div class="sta                                                            -va                                                                                                                                                  stat-description">${cardsData.intensityHero.rat                                                                

            x Normal Activity !</di                                                            /i>                                                             }

                                                                   Alerts(list) {
                                                                                      urn '<div class="inactive-tag">None -                                                                                                                           ="inactive-tag" >                                                                                                                                                          }

                                                              Leaderboard C                                                            ction cr                                                                                     const ctx = docoard-chart                                                                                                 aderboard'                                                                    .destroy();

                                                                                  eaderboard ||                                                                    eaderboard.length) {
                                                                         t('2d').fillStyle = '#888';
                                                                                              Arial';
                                                                                       xt('No leaderboard data available', 50,                                                                    eturn;
                                                                                                                                           s                                                                                                                                                                                          nt = ctx.get                                                                                                                                                                                                                                  ld
                                                                                         '#FFA500')                                                                                                                                                 {
                                                                                   op(0, '#C0C0C0'); // Si                                                                                dColorSto                                                                             }                                                                        dx                                                                          g                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           }
                                                                        ie                                                                                                                                           d'                                                                                                                                                                                                                                      els: leaderboard.map(item                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                map(item => ite                                                                                                                                                                                                                0.5                                                                                                                                                                                                                          ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          x: {
                                                                                                                                                                                                                                                                            size                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   lor: '#00d4ff'                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         lay:                                                                                                                                                                                                                       }

                                                                                                                                                                                                                         legend: {
                                                                                                                                                                                                                                  ,
                                                                                                                                                       callbacks: {
                                                                            label: function (context) {
                                                                                                                                                                                                                                       ' + item.composite_score.toFixed(2                                                                                   'XP                                                                                                                                                                                                                     'Mess                                                                                                         }
                                                                                                                                                                                                                     ,                                                                     datalabels: {

                                                                                                                                                                                                                                                                                                                                                    fo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                });
                                                                                                                                                                                                                   Wa                                                                        const container =                                                                                                        contai                                                                                                                                                                    Messages Data
                                                                              sData() {
                                                                                                                                        wa                                                                                                                           tC                                                            

                                                                          olumeChart(data);
                                                                teRoleDistributionChart(data                                                                reateHeatm                                                                                                                                                                                                                                       {
                                                                                      ng                                                                                                                                                                                                                                       {
                                                                                                      ol                                                                     if                                                                                                                                          s ||                                                                         sages'] =                                                                               type: 'bar',
                                                                                                                                                    ag                                                                                                                                                                       label: 'Total Message                                                                        da                                                                                                                                      0.6                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                    7d                                                                                                                                                                                                    ff                                                                                                                                                                        1
                                                                                                                                           ]
                                                                                                                                   ,
                                                                                                                                                                                                                                             :                                                                        scales: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ti                                                                                   color: '#e0e0e0'
                                                                                                                                                                                                                             grid:                                                                               col                                                                                                                                                                                                                                                                                                                                                                                  plugins:                                                                       legend: {
                                                                                                                                                                                                                                                               }
                                                                     
                                                                                                                                                                                                                                                                                                                        createRoleDistribu                                                                          const ctx = document.getElementById('role-distri                                                                        if (charts['role-distributi                                                                                                                                                                                                                                                                                                                                                   (d                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ff',
                                                                          ec7',
                                                                            90'
                                                                                                                                                                                                                                                                                                                                                                                                                                             >                                                                                       ch                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ue,
                                                                                         e,
                                                                                                                                                      r: {
                                                                                                       ticks: {
                                                               color                                                                                                                     bac                                                            nsparent'
                                                           }

                                                                                                                            ,                                                                                                        grid: {
                                                                            color: 'rgba(0, 212, 255, 0.15)'
                                                                                                                                                                                                                                                                                           ,
                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                  ext) {
                                                                                r                                                                                                                                                                                                                                                                                                                                                          }                                                                                                                                                                                       }

                                                                                                                                                                                                                                                  nst ro                                                                            ]).ma                                                                                                                                           Ro                                                                                        }

                                                                                                                                                         00d4ff;" >${forma                                                                                }

                </                                                                                                                                                                                                                                   TM                                                                                                                                                                                         hart(data) {                                                                tx = document.getE                                                                                                                                                                                                                                                                                                                         [];

                                                                                                                                                                                                                                                                                         ,                                                                                                                                                                                                                                                                                                                                                                                               ll(0);
                                                                                                                                                                                                                                                                                                                                                                               labels: hours,
                                                                                                                                                                                                                                                                                                                              kgr                                                                                                                                                                                                                       ...counts                                                                                const alpha = 0.2 +                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                              dth: 1,
                                                                            dius: 4,
                                                                              ro                                                                                                                                                                                                                                                                                                                                                                                                                                                   options:                                                                    res                                                                                                                                                                                                                                                                                                                                       beginAtZer                                                                                                            ticks: {
                                                                                        ', font: {
                                                                                                             ze: 10
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ,
                                                                                                                                                                              xt                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ip: true, autoSkipPadding: 10
                                                                        }

                                                                                ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       legend: {
                                                                                                                                                                                                                                                                                                        tooltip: {
                                                                        callbacks: {
                                                                                 : (items) => `Time: ${items[0].label
                                                                                }

                                                                                                                                                                                                                             
                                                                                                                                                                                         ,
                                                                                   olor: 'rgba(0, 0, 0, 0.9)'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ,
                                                                         : {
                                                                              1000,
                                                                                      art'
                                                                                                                                                                                                                                                        }

                                                                                                                                                                         Da                                                                                                                                                             ardData();

                                                                             ntB                                                                        St                                                                            crea                                                                               createXPBossChart(data);
                                                                            Sc                                                                                                                                                                                                                                                                                                  conso                                                                                                   }
                                                                                                                                                                                                                                    yId('xp-7                                                                            s['xp-7d']) chart                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           x: x.t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              y: {
                                                                        title: {
                                                                                     true, text: 'XP Gained (7d)'
                                                                        }

                                                                        ,
                                                                        ticks: {
                                                                            color: '#e0e0e0'
                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   displ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ,
                                                                                                                                                              lo                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             });
                                                                                                                                                                                                                                              boss-char                                                                            boss']) charts['x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           x: x.b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    sc                                                                            y: {
                                                                                                                                                                     display: true, text                                                                                                                                                                ,
                                                                         icks: {
                                                                                           '
                                                                                                                                                                                                                                                                                                                           ba(0, 212, 255, 0.1)'
                                                                                                                                                                                                                                                                                                                                                                                title:                                                                               display: true, text:                                                                                      }
                                                                         ,
                                                                          cks: {
                                                                             olor: '#e0e0e0'                                                                         }

                                                                        ,
                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0e0e0'
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                             function createXPMessagesScatt                                                                        const ctx = documen                                                                                                                                        essages-scatter'].de                                                                                                                      ges correlation
                                                                                                                                                                            || [];
                                                                ssages = data.topMe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const msgCo                                                                                                                                                                                                                                                                                                                                                                                                    ,
                                                                                                                                                                                                                                                                                                                                                                                                                                    //                                                                            cons                                                                             'Owner': '#ffb84d',
                                                                                                                                                         ff6                                                                    em                                                                        }                                                                                                                                                             ors).map(role => ({

                                                                                                                                                                                                                                                                                                                                                                                                                                                ],
                                                                                  s[role],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 12
                                                                                                                                                        
                                                                                                                                                  ticks                                                                                color                                                                                                  size:                                                                                 
                                                                                                                                                           ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ue,                                                                                                                           size: 12
                                                                            }
                                                                                                                                                           ,
                                                                                                       ticks: {
                                                                                                            olor: '#888', font: {
                                                                                                                                                                                       }
                                                                                                                            }

                                                                                                       ,
                                                                                                                                                                    color:                                                                                                                                                                                                                                                                                                                                                                               plugins: {
                                                                    legend: {
                                                                                labels: {
                                                                            color: '#e0e0e0', font: {
                                                                                                                                                                                                                                              15
                                                                                                                            }
                                                                                                                                                     ,
                                                                                                                        tooltip                                                                                                       callbacks: {
                                                                                                       label: function (context) {
                                                                                                           const point = correlationData[context.dataInd                                                                                     return [context.dataset.label,
                                                                                'Me                                                                                                                                    parsed.y)];
                                                                                                                                                                                                                            }
                                                                }
                                                                                                                                                                                      }

                                                              pdateXPTable(data) {
                                                                const tbody = document.querySelecto                                                                                                                                      x.name
                                                                               </td> <td><span class="role-badge ${getRoleBadge(x.role)}                                                                        }

                </span></td> <td style="color: #90EE90;" >$                                                                                                                           ff;" >+${formatNumber(x.gained7d)
                                                                                       d style="color: #00d4ff;" >+${formatNumb                                                                            }

                </td> </tr > `                                                                                                tbody.innerolspan=                                                                e</td></tr>';
                                   }

                                                                                                        // Load Outliers Data
                                                                                        ction loadOutliersData() {
                                       try {
                                                                                                                const data = await getDa                                                                                                       document.getElementById('updated-ti                                                            ring('en-GB');

                                                                                                                     dy'                                                               const out                                                                                          const rows = outliers.                                                                                                              </t                                                    .role
                                                                                       </span></td> <td>${o.                                                                           }

                    </td> <td style="co                                                                                                            }

                                                                                                                                           </td> <td style="color: #ffb84d;" >${o.stat                                                                   }

                    </td> </tr > `).join('');                                                              tbody.innerHTML d colspan                                                            iers detected</td></tr                                                                                                                       catch (error) {
                                                            console.error('Error                                                                                          }
                                                                                                                                                                                           async                                                                                     tr                                                                const data = await getDashboardData()                                                               document.getElementById('updated-time-bos                                                        ing('en-GB');

                                                                                                                                                                                                                                                                              rds');
                                                                                                          rBossCards(data.bossCards                                                                                                                              const tbody = document.querySelector('#bosses-                                                                           const bosses                                                                                                                    ` <tr> <td>${idx + 1
                                                                                       </td> <t                                                                                                                   b.role)
                                                                                       </td> <td style="color: #ffb84d;" >${formatNumber(b.total)
                                                                                                                                   kills7d)
                                                                        }

                    </td> <td style="color: #00d4ff;" >${formatNumber(b.kills30d)
                                                                                                                                  > </tr> `).join('');

                                                                                                              ilable</td></t                                                             }

                                                                                                                                                                      s data:', error);
                                                                                                                                                                             // Helper for Boss Icons
                                                           n getBossIconPath(bossName) {
                                                                              'ass                                                                                                                                      th"
                                                                                                                                                                                   a"
                                                                                             .replace(/ /g, '_');

                                                                   ets/boss_${filename
                                                                                                                                                                                                     function getRoleBadge(r                                                               if (!role) return '';
                                                                    le.toLowerCase().trim();
                                                                     =                                                                                //                                                                                                                                                                                      // "deputy o                                                                                                                                                                                                                                                                                                ('deputy') || r.incl                                                                             // Check specific deputy
                                                                                               = 'deputy_owner';
                                                                                                                                                                                                                else if (r.                                                                                                                                                                                                                                                         else if (r.includes('advisor'                                                                 iconRole = 'advisor';
                                                                                                                           e                                                                                                                                             r pref or abundance
                                                                                                                           retur                                                            r: #ccc; display: inli                                                                e}.png" class="rank-icon" onerror="this.style                                                                                    }

                                                                          }

                                                                                                                                                      () => {                                                                    rchDatalist();
                                                                                                                                           p Se                                                                                                                ty-                 setupTableSearch('search-messages', 'messages-table');
                                                            })-                                                                        f                                                                                                                                                                                                      n;

                                                                        f not exists
                                                      t datalist = document.getEle                                                                                  if (!data                                                                datali                                                                                                 datalist.id = 'player-datalist';
                                                                                                                                                             }

                                                                                                                                              data.allMembers.forEach(m => {
                                                                                             ption');
                                                                    opt.value = m.username;
                                                                .appendChild(opt);
                                                                });

                                                                                                                                        document.getElementById('search-general')?.setAttribute('                                                                               document.getElementById('search-messages')?.setAttribute('list', 'player-datalis                                                                                                                    upTableSearch(inputId, tableId)                                                             input = document.getElementByI                                                                if (!input) retur                                                                    ntListener('inpu                                                                     const term = e.ta                                                                                  co                                                                                                                                                                                   const tbo                                                                                           const rows = tbody.querySelectorAll('tr');                                                                            > {
                                                                                                                                                                                                                                                                                    '';
                                                                                                                                                                                                       ty                                                                                                                                                                                                   });
                                                            }

                                                </script>
                                                < !-- OMNI-SEARCH MODAL -->
                                                    <div id="omni-search-overlay" class="omni-overlay">
                                                        <div class="omni-modal">
                                                            <div class="omni-header"><i
                                                                    class="fas fa-search omni-icon"></i><input
                                                                    type="text" id="omni-input"
                                                                    placeholder="Jump to player, boss, or section..."
                                                                    autocomplete="off"><span
                                                                    class="omni-badge">ESC</span></div>
                                                            <div class="omni-results" id="omni-results">
                                                                < !-- Results injected here -->
                                                            </div>
                                                            <div class="omni-footer"><span><i
                                                                        class="fas fa-arrows-alt-v"></i>Navigate</span><span><i
                                                                        class="fas fa-level-down-alt"></i>Select</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <style>
                                                        /* Omni-Search Styles */
                                                        .omni-overlay {
                                                            position: fixed;
                                                            top: 0;
                                                            left: 0;
                                                            width: 100%;
                                                            height: 100%;
                                                            background: rgba(0, 0, 0, 0.8);
                                                            backdrop-filter: blur(5px);
                                                            display: none;
                                                            justify-content: center;
                                                            align-items: flex-start;
                                                            z-index: 9999;
                                                            padding-top: 15vh;
                                                            animation: fadeIn 0.2s ease-out;
                                                        }

                                                        .omni-modal {
                                                            width: 600px;
                                                            max-width: 90%;
                                                            background: rgba(20, 20, 20, 0.95);
                                                            border: 1px solid rgba(0, 212, 255, 0.3);
                                                            border-radius: 12px;
                                                            box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
                                                            overflow: hidden;
                                                            display: flex;
                                                            flex-direction: column;
                                                        }

                                                        .omni-header {
                                                            display: flex;
                                                            align-items: center;
                                                            padding: 15px 20px;
                                                            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                                                            background: rgba(0, 212, 255, 0.05);
                                                        }

                                                        .omni-icon {
                                                            color: var(--neon-blue);
                                                            font-size: 18px;
                                                            margin-right: 15px;
                                                        }

                                                        #omni-input {
                                                            flex: 1;
                                                            background: transparent;
                                                            border: none;
                                                            color: #fff;
                                                            font-family: 'Outfit', sans-serif;
                                                            font-size: 18px;
                                                            outline: none;
                                                        }

                                                        .omni-badge {
                                                            font-size: 10px;
                                                            background: rgba(255, 255, 255, 0.1);
                                                            padding: 2px 6px;
                                                            border-radius: 4px;
                                                            color: #888;
                                                        }

                                                        .omni-results {
                                                            max-height: 400px;
                                                            overflow-y: auto;
                                                            padding: 10px 0;
                                                        }

                                                        .omni-item {
                                                            padding: 10px 20px;
                                                            display: flex;
                                                            align-items: center;
                                                            cursor: pointer;
                                                            border-left: 2px solid transparent;
                                                            transition: 0.1s;
                                                            color: #ccc;
                                                        }

                                                        .omni-item:hover,
                                                        .omni-item.selected {
                                                            background: rgba(0, 212, 255, 0.1);
                                                            border-left-color: var(--neon-blue);
                                                            color: #fff;
                                                        }

                                                        .omni-item-icon {
                                                            width: 20px;
                                                            text-align: center;
                                                            margin-right: 15px;
                                                            color: #888;
                                                        }

                                                        .omni-item-text {
                                                            flex: 1;
                                                            font-size: 14px;
                                                        }

                                                        .omni-item-type {
                                                            font-size: 11px;
                                                            color: #666;
                                                            text-transform: uppercase;
                                                            margin-left: 10px;
                                                        }

                                                        .omni-footer {
                                                            padding: 10px 20px;
                                                            background: rgba(0, 0, 0, 0.3);
                                                            border-top: 1px solid rgba(255, 255, 255, 0.05);
                                                            font-size: 11px;
                                                            color: #666;
                                                            display: flex;
                                                            gap: 20px;
                                                        }
                                                    </style>

                                                    <script>
                                                                                                                                                                                                                                                                                                       let omniSele                                                                    // Build Index                                                                n buildOmniIndex() {
                                                                                                                                                                                                                                                               e: 'General Stats', action: () =                                                                                                                      ect                                                        '), icon: 'fa-trop                                                                       { type: 'Section', name                                                            -comment-alt' },
                                                                                                       action: () => switchSecti                                                                                                                                             action: () => switchSe                                                                                                                      { type: 'Section', name: 'Boss Activity', action: () =>                                                                                                                                     Ro                                                                                                                                                                                              if (data &                                                                                     data.allMembers.forEach(m => {
                                                                        Index.push({
                                                                                type: 'Player',
                                                                                name: m.username,
                                                                                action: () => {
                                                                            switchSection('roster');
                                                                                    ut(() => {
                                                                                c                                                                                                                                if (se                                                                                                                                                                                                                                                                                             ico                                                                                 });                                                                 });
                                                                                                                                                                                                                                                                                                                                                                                                                                                             ementById('omni-sear                                                                          cons                                                                                                                                                                                                   .display = 'fl                                                                     if (!omniIndex.length) buildOmniIndex();
                                                                 nput.value = '';
                                                                            sults(omniIndex.slic                                                                                                input.focus();
                                                                                                                                                               one';
                                                                                                                                                                                         // Render Results
                                                                                     sults) {
                                                                      ainer = document.getElementById(                                                                             contain                                                                               omniSelection = 0;

                                                                                 {
                                                                                                                     ; text-align: ce                                                                                                return;
                                                                                                                                                                                                                                    const div = document.createElement('d                                                                      div.className = `omni-item ${idx                                                                                                                                      <div class="                                                                               <div class="omni-item-text">${item.name}</di                                                                pe}</div>
                                                                                               div.onclick = () => {                                                                                                 container.app                                                                                                                                                                                                                                                                                                            own'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           }
                                                                (!omniOpen) return;

                                                                                                                                       if (e.key === 'Escape') {
                                                                                ()                                                                  toggleOmni();
                                                                                                                                    }

                                                                                                                                      const i                                                                                                                                                                                                         e.                                                                                  omniSelection = Math.min(omniSelection                                                                                                                                                                        } else if (e.key === 'ArrowUp') {
                                                                    eventDefault();
                                                                                                                                                                                       el                                                                      } else if (                                                                                     e.preventDefault();
                                                                                                        ction].click();
                                                                    }
                                                                                                                                                                                                                                          tListener('input', (e) => {
                                                                              get.value.toLowerCase();                                                             const filtered = omniIndex.filter(i => i.name.toLowerCase().includes(term));
                                                               derOmniResults(filtered.slice(0, 15));
                                                                                                                                                                                                                                       ('.omni-item').forEach((el, id                                                                        if (idx === omniSelection) {
                                                                    el.classList.add('selected');
                                                                                oView({ block: 'nearest' });
                                                                                         eList.remove('selected');
                                                                        }
                                                                    });
                                                                }

                                                                // --- SKELETON LOADING ---
                                                                function renderSkeletonRows(cols, rows = 5) {
                                                                    let html = '';
                                                                    for (let i = 0; i < rows; i++) {
                                                                        html += '<tr>';
                                                                        for (let j = 0; j < cols; j++) {
                                                                            html += `<td><div class="skeleton-text" style="width: ${Math.random() * 40 + 60}%"></div></td>`;
                                                                        }
                                                                        html += '</tr>';
                                                                    }
                                                                    return html;
                                                                }

                                                                // --- ORACLE RENDER ---
                                                                function renderOracle(data) {
                                                                    const oracleVal = document.getElementById('oracle-val');
                                                                    const oracleDesc = document.getElementById('oracle-desc');

                                                                    if (!data || !data.length) {
                                                                        if (oracleVal) oracleVal.textContent = "No Visions";
                                                                        if (oracleDesc) oracleDesc.textContent = "The future is clouded.";
                                                                        return;
                                                                    }
                                                                    const top = data[0];
                                                                    if (oracleVal) oracleVal.innerHTML = `<span style="color: #d8b4fe;">${top.name}</span>`;
                                                                    if (oracleDesc) oracleDesc.innerHTML = `Hits <b>${top.milestone}</b> in <b style="color: #fff;">${top.days_left} days</b>`;
                                                                }

                                                                // Initial Build on Load
                                                                window.addEventListener('load', buildOmniIndex);

                                                                
                                // --- NEW COMPONENT LOGIC (NEON GIELINOR) ---
                                function renderAlertCards(members) {
                                    const container = document.getElementById('alert-cards-container');
                                    if (!container) return;

                                    // Identify Churn Risks: >10m Total XP, <25k XP last 7d, <10 messages last 30d
                                    const risks = members.filter(m => m.total_xp > 10000000 && m.xp_7d < 25000 && m.msgs_30d < 10).sort((a,b) => b.total_xp - a.total_xp).slice(0, 3);

                                    if (risks.length === 0) {
                                        container.innerHTML = '<div class="glass-card" style="grid-column: 1/-1; padding: 20px; text-align: center; color: var(--neon-green);">No immediate churn risks detected.</div>';
                                        return;
                                    }

                                    container.innerHTML = risks.map(m => `
                                        <div class="glass-card alert-card">
                                            <div class="stat-label" style="color: var(--neon-red); letter-spacing: 2px;"><i class="fas fa-radiation"></i> CHURN RISK</div>
                                            <div class="stat-value" style="font-size: 20px; margin: 10px 0;">${m.username}</div>
                                            <div class="stat-description" style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                                                <span>XP (7d): ${parseInt(m.xp_7d).toLocaleString()}</span>
                                                <span>Msgs (30d): ${m.msgs_30d}</span>
                                            </div>
                                            <div style="margin-top: 15px; height: 1px; background: linear-gradient(90deg, transparent, var(--neon-red), transparent);"></div>
                                        </div>
                                    `).join('');
                                }

                                function renderBingoGrid() {
                                    const container = document.getElementById('bingo-grid');
                                    if (!container) return;

                                    // VISUAL DEMO for Bingo Grid
                                    const bingoBosses = [
                                        { name: 'Vorkath', progress: 100, complete: true },
                                        { name: 'Zulrah', progress: 45, complete: false },
                                        { name: 'Chambers', progress: 12, complete: false },
                                        { name: 'ToA', progress: 100, complete: true },
                                        { name: 'Muspah', progress: 88, complete: false }
                                    ];

                                    container.innerHTML = bingoBosses.map(b => `
                                        <div class="glass-card bingo-card" style="${b.complete ? 'border: 1px solid var(--neon-green); box-shadow: inset 0 0 20px rgba(51, 255, 51, 0.2);' : ''}">
                                            <div class="bingo-progress" style="${b.complete ? 'color: var(--neon-green); text-shadow: 0 0 10px lime;' : ''}">
                                                ${b.complete ? '<i class="fas fa-check-circle"></i>' : b.progress + '%'}
                                            </div>
                                            <div class="bingo-boss-name">${b.name}</div>
                                        </div>
                                    `).join('');
                                }

// --- ORACLE PATCH ---
                                                                // Robustly hook into the data load process without modifying the original function body
                                                                const _originalLoadGeneral = loadGeneralData;
                                                                loadGeneralData = async function () {
                                                                    try {
                                                                        await _originalLoadGeneral();
                                                                        const data = await getDashboardData();
                                                                        if (data) {
                                            if (data.oracle) renderOracle(data.oracle);
                                            if (data.allMembers) {
                                                renderAlertCards(data.allMembers);
                                                renderBingoGrid();
                                            }
                                        }
                                                                    } catch (e) { console.error("Oracle Patch Failed", e); }
                                                                };
                                                    </script>
</body>

</html>