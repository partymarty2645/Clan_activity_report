# ClanStats Dashboard Audit Report

## 1. Executive Summary

The ClanStats dashboard is a visually striking, data-rich application. However, a technical audit reveals significant reliability risks and performance bottlenecks. The architecture suffers from "Library Bloat" (loading 7+ external libraries) and fragile data coupling between the Python backend and the static frontend.

**Key Findings:**

* **Critical Reliability Risk:** The dashboard relies on a fragile "dual-source" data loading method (`window.variable` vs `fetch`) that can easily lead to "stale data" or silent crashes.
* **Performance Bottleneck:** The application loads ~2MB of JavaScript libraries (Chart.js + G2Plot + Particles + others) before rendering a single number.
* **Technical Debt:** The codebase relies heavily on global variables and `innerHTML` string injection, which makes maintenance difficult and error-prone.

## 2. Reliability & Critical Logic Audit

These issues directly threaten the uptime or accuracy of the dashboard.

### 2.1. Fragile Sorting Mechanism

The `sortTable` function in `dashboard_logic.js` implements a manual bubble-sort algorithm (`while(switching)`).

* **Risk:** This is O(N^2) complexity. If the clan roster grows or if "bad data" (non-numeric strings) enters the table, this loop can freeze the browser or enter an infinite loop.
* **Fragility:** It relies on regex stripping (`.replace(/[+,kM\s]/g, '')`) to parse numbers. If the Python script changes the number format (e.g., adds "B" for Billions), the sorting will break silently.

### 2.2. Data Loading Race Conditions

The dashboard attempts to load data from `window.dashboardData` (embedded in `clan_data.js`) and falls back to fetching `clan_data.json`.

* **Risk:** `clan_data.js` and `clan_data.json` are two separate artifacts generated by the backend. If the export script fails halfway, you might have an updated JSON but an old JS file (or vice versa). The dashboard logic is ambiguous about which source is the "Single Source of Truth," leading to potential version mismatches.

### 2.3. Missing "Fail-Safe" States

* **Risk:** The `safelyRun` wrapper catches errors but simply logs them. If `renderGeneralStats` fails, the user sees "Loading..." forever with no indication of what went wrong. A crash in a chart library (e.g., G2Plot fails to load) can halt the entire execution flow if not isolated properly.

## 3. UI Performance Optimization Audit

The dashboard is visually heavy, but performance is suboptimal due to inefficient resource usage.

### 3.1. Library Bloat (The "7-Library Problem")

The dashboard loads an excessive number of external libraries for its feature set:

1. `Chart.js` (Heavy charting)
2. `G2Plot` / AntV (ANOTHER heavy charting library)
3. `Particles.js` (Canvas animation loop)
4. `Vanilla-tilt.js` (3D tilt effects)
5. `Popper.js` (Tooltips)
6. `Tippy.js` (Tooltips)
7. `SweetAlert2` (Modals)

* **Impact:** This dramatically increases "Time to Interactive" (TTI). Loading both Chart.js AND G2Plot is redundant.
* **Recommendation:** Standardize on **ONE** charting library (Chart.js is already implemented for 80% of charts). Remove `Particles.js` on mobile devices.

### 3.2. Main Thread Blocking & Repaints

* **Issue:** `dashboard_logic.js` frequently uses `el.innerHTML = ...` to update stats. This destroys the DOM nodes and forces the browser to re-parse and re-paint the layout (Reflow).
* **Issue:** `renderRecentActivity` is called **twice** in the initialization block (Lines 172 & 173 of `dashboard_logic.js`). This is pure wasted computation.

### 3.3. Memory Leaks in Chart Re-rendering

* **Issue:** Charts are stored in a global `charts` object. When switching tabs or resizing, the code attempts to `.destroy()` them, but if an error occurs during destruction (e.g., chart not fully initialized), the old canvas instance remains in memory. Over a long session, this causes the tab to consume increasing amounts of RAM.

## 4. Code Quality & Technical Debt Audit

"Bad habits" that make the code hard to read and modify.

* **Global Namespace Pollution:** Variables like `dashboardData`, `currentPeriod`, and functions like `switchSection` are attached directly to `window`. This is effectively "Global State," which is the root of many sophisticated bugs.
* **HTML-in-JS:** The render functions contain massive strings of HTML logic (e.g., `renderAlertCards`). This "Spaghetti Code" has no syntax highlighting, is hard to debug, and makes changing the design a nightmare.
* **Hardcoded Configuration:** Values like `CLAN_FOUNDING_DATE` or "7d" vs "30d" logic are hardcoded deep within the JavaScript, rather than pulled from the `CONFIG` object or the JSON data.

## 5. Overengineering Findings

Features that are too complex for the value they provide.

* **Omni-Search:** The dashboard implements a complex "Omni-Search" modal. For a roster of <500 items, a simple persistent search bar (filtering the DOM) is instant and requires 90% less code.
* **Particles.js:** While it looks "cool," it consumes significant CPU for a background effect that most users will ignore after 5 seconds. On mobile, this drains battery.

## 6. UI/UX Upgrade Roadmap (The "Premium" Plan)

To transition from a "Spreadsheet" feel to a "Gaming Hub" experience.

1. **Dynamic Achievement "Toasts":** A notification system that "pops up" achievement banners (Level 99s, big drops) when the dashboard is opened, mimicking the in-game level-up feel.
2. **Toggleable "Parchment" Theme:** A UI toggle to switch from "Obsidian Neon" to a "Gielinor Classic" theme (aged parchment background, leather borders, and OSRS-native font).
3. **Interactive Boss Portraits:** Replace static text lists with clickable boss icons. Clicking a boss should expand a side panel showing the clan's Top 10 killers and their specific "Kill Tiers" (Expert vs Regular).
4. **XP Progress Bars:** Use animated progress bars that visually fill based on the player's 30d goal vs actual gain, giving a sense of momentum.
5. **Interactive Heatmap Drill-down:** Make the activity heatmap clickable. Clicking an "Active Hour" should show which players were active during that window (e.g. "Who is online at 3 AM?").
6. **Player "Headshots":** Use WOM avatar links or generate OSRS-style equipment portraits to make the roster feel like a guild of real people rather than a spreadsheet of names.
7. **Integrated Highscores Context:** A "Compare with Highscores" button that opens an iframe/link to the official OSRS highscores page for that character directly in the profile modal.
8. **Discord Status Indicator:** Show a small green/grey dot next to usernames if the bot detects they have been "active" on Discord in the last 15 minutes (requires real-time data or recent-msg check).
9. **Keyboard Gamer Hotkeys:** Implement hotkeys (e.g., `1-9` to switch tabs, `/` to focus search, `ESC` to close modals).
10. **Progressive Web App (PWA) Support:** Add a `manifest.json` so clan leaders can "Install" the dashboard as a standalone app on their mobile home screen (eliminating the browser URL bar).
